# Africa AIM - Supabase Integration

This project integrates Supabase for authentication and database functionality. Below is a guide on how to set up and use Supabase with this application.

## Setup Instructions

### 1. Supabase Project Setup

1. Create a Supabase account at [https://supabase.com](https://supabase.com) if you don't have one already
2. Create a new project in Supabase
3. Once your project is created, go to Project Settings > API to get your:
   - Project URL
   - Project API Key (anon/public)

### 2. Environment Configuration

1. Update the `.env` file with your Supabase credentials:

```
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

### 3. Authentication Setup

1. In your Supabase dashboard, go to Authentication > Providers
2. Enable Email/Password authentication
3. For GitHub authentication:
   - Go to [GitHub Developer Settings](https://github.com/settings/developers)
   - Create a new OAuth App
   - Set the Authorization callback URL to: `https://your-project-id.supabase.co/auth/v1/callback`
   - Copy the Client ID and Client Secret
   - Add these to your Supabase GitHub provider settings
4. For Google authentication:
   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Create a new project or use an existing one
   - Go to APIs & Services > Credentials
   - Create an OAuth 2.0 Client ID
   - Set the Authorized redirect URI to: `https://your-project-id.supabase.co/auth/v1/callback`
   - Copy the Client ID and Client Secret
   - Add these to your Supabase Google provider settings

### 4. Database Schema Setup

Execute the following SQL in your Supabase SQL Editor to create the necessary tables:

```sql
-- Users & Profiles
CREATE TABLE profiles (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE NOT NULL,
  username TEXT UNIQUE NOT NULL,
  full_name TEXT,
  avatar_url TEXT,
  category TEXT CHECK (category IN ('consumer', 'provider', 'freelancer')) NOT NULL,
  bio TEXT,
  last_login TIMESTAMP WITH TIME ZONE
);

-- AI Models
CREATE TABLE models (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  name TEXT NOT NULL,
  owner_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  description TEXT,
  model_type TEXT NOT NULL,
  industry TEXT,
  language TEXT,
  country TEXT,
  downloads INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  huggingface_url TEXT
);

-- Datasets
CREATE TABLE datasets (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  name TEXT NOT NULL,
  owner_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  description TEXT,
  dataset_type TEXT NOT NULL,
  format TEXT NOT NULL,
  industry TEXT,
  language TEXT,
  country TEXT,
  downloads INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  size TEXT
);

-- Posts for community and forum
CREATE TABLE posts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  title TEXT,
  content TEXT NOT NULL,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  image_url TEXT,
  is_forum BOOLEAN DEFAULT FALSE,
  likes_count INTEGER DEFAULT 0,
  dislikes_count INTEGER DEFAULT 0,
  comments_count INTEGER DEFAULT 0
);

-- Comments
CREATE TABLE comments (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  content TEXT NOT NULL,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  post_id BIGINT REFERENCES posts(id) ON DELETE CASCADE,
  parent_comment_id BIGINT REFERENCES comments(id) ON DELETE CASCADE,
  likes_count INTEGER DEFAULT 0,
  dislikes_count INTEGER DEFAULT 0
);
```

### 5. Row Level Security (RLS) Policies

Set up RLS policies to secure your data:

```sql
-- Enable RLS on all tables
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE models ENABLE ROW LEVEL SECURITY;
ALTER TABLE datasets ENABLE ROW LEVEL SECURITY;
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;

-- Profiles policies
CREATE POLICY "Profiles are viewable by everyone" 
ON profiles FOR SELECT USING (true);

CREATE POLICY "Users can update their own profile" 
ON profiles FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own profile" 
ON profiles FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Models policies
CREATE POLICY "Models are viewable by everyone" 
ON models FOR SELECT USING (true);

CREATE POLICY "Users can update their own models" 
ON models FOR UPDATE USING (auth.uid() = owner_id);

CREATE POLICY "Users can insert their own models" 
ON models FOR INSERT WITH CHECK (auth.uid() = owner_id);

-- Similar policies for other tables...
```

## Using Supabase in the Application

### Authentication

The application includes a Supabase authentication provider that handles user authentication. You can use the following components:

- `AuthButtons.tsx`: Provides buttons for GitHub and Google authentication
- `SupabaseAuthContext.tsx`: Context provider for authentication state

Example usage:

```jsx
import { useAuth } from '../contexts/SupabaseAuthContext';

function MyComponent() {
  const { user, signInWithGitHub, signOut } = useAuth();
  
  return (
    <div>
      {user ? (
        <div>
          <p>Welcome, {user.email}</p>
          <button onClick={signOut}>Sign Out</button>
        </div>
      ) : (
        <button onClick={signInWithGitHub}>Sign in with GitHub</button>
      )}
    </div>
  );
}
```

### Database Operations

The application includes example components that demonstrate how to interact with the Supabase database:

- `PostsList.tsx`: Shows how to fetch and display posts
- `ModelsList.tsx`: Shows how to fetch and display AI models

Example of a database query:

```jsx
import { supabase } from '../lib/supabase';

// Fetch data
const fetchData = async () => {
  const { data, error } = await supabase
    .from('table_name')
    .select('*')
    .order('created_at', { ascending: false });
    
  if (error) {
    console.error('Error fetching data:', error);
    return [];
  }
  
  return data || [];
};

// Insert data
const insertData = async (newItem) => {
  const { data, error } = await supabase
    .from('table_name')
    .insert([newItem])
    .select();
    
  if (error) {
    console.error('Error inserting data:', error);
    return null;
  }
  
  return data?.[0] || null;
};
```

## Example Routes

The application includes example routes to demonstrate Supabase functionality:

- `/supabase-auth`: Demonstrates authentication with GitHub and Google
- `/supabase-posts`: Shows how to fetch and display posts from the database
- `/supabase-models`: Shows how to fetch and display AI models from the database

## Additional Resources

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript/introduction)
- [Supabase Auth Helpers](https://supabase.com/docs/guides/auth/auth-helpers)
